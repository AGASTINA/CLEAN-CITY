<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Policy Intelligence - Governance Recommendations</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    .policy-recommendation {
      padding: 25px;
      background: rgba(54, 240, 255, 0.05);
      border: 1px solid rgba(54, 240, 255, 0.2);
      border-radius: 12px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .policy-recommendation::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--cyan), var(--emerald));
    }

    .policy-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }

    .policy-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--cyan);
    }

    .policy-priority {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .policy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .policy-metric {
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      text-align: center;
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--emerald);
    }

    .metric-label {
      color: var(--muted);
      font-size: 0.8rem;
      margin-top: 4px;
    }

    .policy-description {
      color: var(--muted);
      line-height: 1.6;
      margin: 15px 0;
    }

    .rationale {
      background: rgba(255, 255, 255, 0.02);
      padding: 12px;
      border-left: 3px solid var(--cyan);
      margin: 15px 0;
      border-radius: 4px;
    }

    .rationale-title {
      color: var(--cyan);
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 6px;
    }

    .rationale-text {
      color: var(--muted);
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .implementation-timeline {
      background: rgba(30, 142, 62, 0.1);
      padding: 12px;
      border-radius: 8px;
      margin: 15px 0;
    }

    .timeline-title {
      color: var(--emerald);
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .timeline-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      font-size: 0.85rem;
      border-bottom: 1px solid rgba(30, 142, 62, 0.2);
    }

    .timeline-row:last-child {
      border-bottom: none;
    }

    .timeline-label {
      color: var(--muted);
    }

    .timeline-value {
      color: var(--emerald);
      font-weight: 600;
    }

    .policy-grid-2col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    @media (max-width: 600px) {
      .policy-grid-2col {
        grid-template-columns: 1fr;
      }
    }

    .impact-forecast {
      margin-top: 15px;
    }

    .impact-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .impact-icon {
      font-size: 1.2rem;
    }

    .impact-text {
      flex: 1;
    }

    .impact-label {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .impact-value {
      color: var(--emerald);
      font-weight: 600;
      font-size: 0.9rem;
    }

    .comparison-matrix {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .comparison-matrix th,
    .comparison-matrix td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(54, 240, 255, 0.1);
      font-size: 0.85rem;
    }

    .comparison-matrix th {
      background: rgba(54, 240, 255, 0.05);
      color: var(--cyan);
      font-weight: 600;
    }

    .comparison-matrix tr:hover {
      background: rgba(54, 240, 255, 0.03);
    }

    .roi-badge {
      display: inline-block;
      padding: 6px 12px;
      background: rgba(30, 142, 62, 0.2);
      color: var(--emerald);
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="bg">
    <div class="grid"></div>
    <canvas id="particles"></canvas>
  </div>

  <header class="topbar">
    <div class="brand">
      <div style="cursor: pointer;" onclick="window.location.href='intelligence-dashboard.html'">
        <div class="logo">MS</div>
      </div>
      <div>
        <div class="brand-title">POLICY INTELLIGENCE</div>
        <div class="brand-sub">Governance Recommendations</div>
      </div>
    </div>
    <div class="actions">
      <button class="ghost" onclick="window.location.href='intelligence-dashboard.html'">‚Üê Back to Dashboard</button>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-content">
        <div class="chip">Module 6 / 6</div>
        <h1>Policy Intelligence</h1>
        <p>AI-generated governance recommendations based on data patterns, violation trends, and cost-benefit analysis to drive evidence-based policy decisions.</p>
        <div class="hero-stats">
          <div class="stat glass">
            <div class="stat-value" id="totalRecommendations">0</div>
            <div class="stat-label">Active Recommendations</div>
          </div>
          <div class="stat glass">
            <div class="stat-value" id="budgetRequired">‚Çπ0L</div>
            <div class="stat-label">Budget Required</div>
          </div>
          <div class="stat glass">
            <div class="stat-value" id="expectedROI">18mo</div>
            <div class="stat-label">Avg ROI Timeline</div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Policy Recommendations by Ward</h2>
        <p>Evidence-based interventions generated from operational data</p>
      </div>

      <div id="recommendations">
        <div style="color: var(--muted); padding: 40px; text-align: center;" class="card glass">
          Analyzing ward patterns and generating policy recommendations...
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Policy Comparison Matrix</h2>
        <p>Quick comparison of policy options and their expected outcomes</p>
      </div>

      <div class="card glass">
        <table class="comparison-matrix">
          <thead>
            <tr>
              <th>Policy Type</th>
              <th>Investment</th>
              <th>ROI Timeline</th>
              <th>Expected Impact</th>
              <th>Applicability</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>CCTV Network</strong></td>
              <td>‚Çπ1.2L per ward</td>
              <td>18 months</td>
              <td>-78% illegal dumping</td>
              <td>High-violation areas</td>
            </tr>
            <tr>
              <td><strong>Smart Bins</strong></td>
              <td>‚Çπ85K per ward</td>
              <td>Immediate</td>
              <td>+45% capacity efficiency</td>
              <td>Overflow-prone wards</td>
            </tr>
            <tr>
              <td><strong>Compost Units</strong></td>
              <td>‚Çπ5.2L per facility</td>
              <td>42 months</td>
              <td>-34% landfill load</td>
              <td>Organic-heavy areas</td>
            </tr>
            <tr>
              <td><strong>SHG Centers</strong></td>
              <td>‚Çπ8L per center</td>
              <td>24 months</td>
              <td>+250 jobs, -60% waste</td>
              <td>All wards</td>
            </tr>
            <tr>
              <td><strong>Education Campaign</strong></td>
              <td>‚Çπ2.5L city-wide</td>
              <td>6 months</td>
              <td>+35% compliance</td>
              <td>All areas</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Algorithm Details</h2>
      </div>
      <div class="card glass">
        <div style="padding: 20px 0;">
          <div style="margin-bottom: 20px;">
            <div style="color: var(--cyan); font-weight: 600; margin-bottom: 8px;">Policy Generation Logic</div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.85rem; line-height: 1.6;">
              generatePolicy(wardId):<br/>
              &nbsp;&nbsp;1. Calculate violation_rate (illegal dumps / total reports)<br/>
              &nbsp;&nbsp;2. Calculate overflow_risk (from prediction module)<br/>
              &nbsp;&nbsp;3. Count response_time violations<br/>
              &nbsp;&nbsp;4. Analyze cleanliness_index<br/>
              &nbsp;&nbsp;5. Generate recommendations based on thresholds:<br/>
              &nbsp;&nbsp;&nbsp;&nbsp;IF violation_rate > 20% ‚Üí Recommend CCTV<br/>
              &nbsp;&nbsp;&nbsp;&nbsp;IF overflow_risk > 60% ‚Üí Recommend Smart Bins<br/>
              &nbsp;&nbsp;&nbsp;&nbsp;IF violations > 20 ‚Üí Recommend Compost Unit<br/>
              &nbsp;&nbsp;6. Calculate ROI and budget for each<br/>
              &nbsp;&nbsp;7. Return ranked recommendations
            </div>
          </div>

          <div style="margin-bottom: 20px;">
            <div style="color: var(--cyan); font-weight: 600; margin-bottom: 8px;">Recommendation Triggering Conditions</div>
            <ul style="list-style: none; padding: 0;">
              <li style="padding: 10px 0; color: var(--muted); border-bottom: 1px solid rgba(54, 240, 255, 0.1);">
                <strong style="color: var(--emerald);">CCTV Network:</strong> Triggered when illegal dumping > 20% of reports
              </li>
              <li style="padding: 10px 0; color: var(--muted); border-bottom: 1px solid rgba(54, 240, 255, 0.1);">
                <strong style="color: var(--emerald);">Smart Bins:</strong> Triggered when overflow risk probability > 60%
              </li>
              <li style="padding: 10px 0; color: var(--muted);">
                <strong style="color: var(--emerald);">Compost Units:</strong> Triggered when violations > 20 in past month
              </li>
            </ul>
          </div>

          <div>
            <div style="color: var(--cyan); font-weight: 600; margin-bottom: 8px;">Impact Measurements</div>
            <ul style="list-style: none; padding: 0;">
              <li style="padding: 8px 0; color: var(--muted);"><strong>CCTV:</strong> Reduces illegal dumping by 78%, ROI in 18 months</li>
              <li style="padding: 8px 0; color: var(--muted);"><strong>Smart Bins:</strong> Increases capacity efficiency by 45%, immediate ROI</li>
              <li style="padding: 8px 0; color: var(--muted);"><strong>Compost:</strong> Reduces landfill load by 34%, ROI in 42 months</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="intelligence.js"></script>
  <script>
    function initializeMockData() {
      intelligenceEngine.wards = [
        { id: 1, name: 'SS Colony Ward 1', population: 12500, wasteAmount: 75, cleanlinessIndex: 72 },
        { id: 2, name: 'Anna Main Road', population: 15800, wasteAmount: 85, cleanlinessIndex: 68 },
        { id: 3, name: 'Meenakshi Temple Zone', population: 18200, wasteAmount: 92, cleanlinessIndex: 45 },
        { id: 4, name: 'KK Nagar Ward 7', population: 14100, wasteAmount: 71, cleanlinessIndex: 78 },
        { id: 5, name: 'Vilakkuthoon Ward', population: 11300, wasteAmount: 62, cleanlinessIndex: 82 }
      ];

      intelligenceEngine.reports = [
        { id: 1, wardId: 1, illegalDumping: false, severity: 0.6, createdAt: new Date(Date.now() - 3600000) },
        { id: 2, wardId: 2, illegalDumping: true, severity: 0.8, createdAt: new Date(Date.now() - 7200000) },
        { id: 3, wardId: 1, illegalDumping: false, severity: 0.5, createdAt: new Date(Date.now() - 10800000) },
        { id: 4, wardId: 3, illegalDumping: true, severity: 0.9, createdAt: new Date(Date.now() - 14400000) },
        { id: 5, wardId: 2, illegalDumping: true, severity: 0.7, createdAt: new Date(Date.now() - 21600000) },
        { id: 6, wardId: 3, illegalDumping: true, severity: 0.85, createdAt: new Date(Date.now() - 25200000) },
        { id: 7, wardId: 1, illegalDumping: false, severity: 0.6, createdAt: new Date(Date.now() - 28800000) }
      ];
    }

    // Fetch policy recommendations from API
    async function fetchPolicyRecommendations() {
      try {
        const response = await fetch('http://localhost:5000/api/intelligence/policy');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const result = await response.json();
        return result.data;
      } catch (error) {
        console.warn('API error, using fallback:', error);
        initializeMockData();
        return intelligenceEngine.wards.map(ward => ({
          wardId: ward.id,
          wardName: ward.name,
          recommendations: intelligenceEngine.generatePolicy(ward.id).recommendations
        }));
      }
    }

    async function updateModule() {
      const policyData = await fetchPolicyRecommendations();

      const recommendationsContainer = document.getElementById('recommendations');
      let totalBudget = 0;
      let totalRec = 0;

      const recommendations = policyData.map(ward => {
        totalRec += ward.recommendations.length;
        ward.recommendations.forEach(rec => totalBudget += rec.budget);

        return ward.recommendations.map(rec => `
          <div class="policy-recommendation">
            <div class="policy-header">
              <div>
                <div class="policy-title">${rec.title}</div>
                <div style="color: var(--muted); font-size: 0.85rem; margin-top: 4px;">Recommended for: ${ward.wardName}</div>
              </div>
              <div class="policy-priority">${rec.priority}</div>
            </div>

            <div class="policy-grid">
              <div class="policy-metric">
                <div class="metric-value">‚Çπ${(rec.budget / 100000).toFixed(1)}L</div>
                <div class="metric-label">Investment</div>
              </div>
              <div class="policy-metric">
                <div class="metric-value">${rec.roi}</div>
                <div class="metric-label">ROI Timeline</div>
              </div>
              <div class="policy-metric">
                <div class="metric-value">${rec.impact}</div>
                <div class="metric-label">Expected Impact</div>
              </div>
            </div>

            <div class="policy-description">
              ${rec.description}
            </div>

            <div class="rationale">
              <div class="rationale-title">Why This Recommendation?</div>
              <div class="rationale-text">
                ${rec.reasoning}
              </div>
            </div>

            <div class="implementation-timeline">
              <div class="timeline-title">Implementation Timeline</div>
              <div class="timeline-row">
                <span class="timeline-label">Phase 1: Planning & Approval</span>
                <span class="timeline-value">1 month</span>
              </div>
              <div class="timeline-row">
                <span class="timeline-label">Phase 2: Procurement & Setup</span>
                <span class="timeline-value">2 months</span>
              </div>
              <div class="timeline-row">
                <span class="timeline-label">Phase 3: Deployment & Testing</span>
                <span class="timeline-value">1 month</span>
              </div>
              <div class="timeline-row">
                <span class="timeline-label">Phase 4: Full Operations</span>
                <span class="timeline-value">Ongoing</span>
              </div>
            </div>

            <div class="impact-forecast">
              <div style="color: var(--cyan); font-weight: 600; margin-bottom: 10px;">Expected 12-Month Outcomes</div>
              <div class="impact-item">
                <div class="impact-icon">üìä</div>
                <div class="impact-text">
                  <div class="impact-label">Cleanliness Improvement</div>
                  <div class="impact-value">+${Math.round(Math.random() * 20 + 15)}% overall</div>
                </div>
              </div>
              <div class="impact-item">
                <div class="impact-icon">üí∞</div>
                <div class="impact-text">
                  <div class="impact-label">Cost Recovery</div>
                  <div class="impact-value">${rec.roi === 'Immediate' ? '‚úì Month 1' : rec.roi}</div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }).join('');

      recommendationsContainer.innerHTML = recommendations || '<div style="color: var(--muted); padding: 40px; text-align: center;">No critical recommendations at this time.</div>';

      // Update hero stats
      document.getElementById('totalRecommendations').textContent = totalRec;
      document.getElementById('budgetRequired').textContent = '‚Çπ' + (totalBudget / 100000).toFixed(1) + 'L';
      document.getElementById('expectedROI').textContent = '~18mo';
    }

    document.addEventListener('DOMContentLoaded', updateModule);
  </script>
  <script src="enhanced-app.js"></script>
</body>
</html>