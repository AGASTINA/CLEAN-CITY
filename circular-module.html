<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Circular Intelligence - Waste-to-Value Economics</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    .circular-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .circular-card {
      padding: 20px;
      background: rgba(54, 240, 255, 0.05);
      border: 1px solid rgba(54, 240, 255, 0.2);
      border-radius: 12px;
    }

    .circular-title {
      color: var(--cyan);
      font-weight: 600;
      margin-bottom: 15px;
    }

    .waste-type-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--emerald);
      margin: 10px 0;
    }

    .value-breakdown {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(54, 240, 255, 0.2);
    }

    .value-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      font-size: 0.85rem;
    }

    .value-label {
      color: var(--muted);
    }

    .value-amount {
      color: var(--cyan);
      font-weight: 600;
    }

    .processor-card {
      padding: 15px;
      background: rgba(30, 142, 62, 0.1);
      border: 1px solid rgba(30, 142, 62, 0.3);
      border-radius: 8px;
      margin-top: 10px;
    }

    .processor-name {
      color: var(--emerald);
      font-weight: 600;
      font-size: 0.9rem;
    }

    .processor-detail {
      color: var(--muted);
      font-size: 0.8rem;
      margin-top: 4px;
    }

    .revenue-breakdown {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .revenue-item {
      padding: 15px;
      background: rgba(54, 240, 255, 0.05);
      border: 1px solid rgba(54, 240, 255, 0.2);
      border-radius: 8px;
      text-align: center;
    }

    .revenue-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .revenue-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--emerald);
      margin: 8px 0;
    }

    .revenue-label {
      color: var(--muted);
      font-size: 0.8rem;
    }

    .environmental-impact {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .impact-card {
      padding: 15px;
      background: rgba(30, 142, 62, 0.1);
      border-left: 4px solid var(--emerald);
      border-radius: 8px;
    }

    .impact-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--emerald);
      margin: 8px 0;
    }

    .impact-label {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .calculator-section {
      background: rgba(255, 255, 255, 0.02);
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
    }

    .calc-input {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .calc-input input {
      flex: 1;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(54, 240, 255, 0.2);
      color: var(--cyan);
      border-radius: 6px;
      font-family: monospace;
    }

    .calc-input input::placeholder {
      color: var(--muted);
    }

    .calc-button {
      padding: 10px 20px;
      background: linear-gradient(135deg, var(--cyan), var(--emerald));
      color: var(--navy);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .calc-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(54, 240, 255, 0.3);
    }

    .calc-result {
      background: rgba(54, 240, 255, 0.1);
      border: 1px solid rgba(54, 240, 255, 0.3);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .result-title {
      color: var(--cyan);
      font-weight: 600;
      margin-bottom: 10px;
    }

    .shg-network {
      background: rgba(30, 142, 62, 0.1);
      border: 1px solid rgba(30, 142, 62, 0.3);
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }

    .shg-title {
      color: var(--emerald);
      font-weight: 600;
      margin-bottom: 10px;
    }

    .shg-stat {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(30, 142, 62, 0.2);
    }

    .shg-stat:last-child {
      border-bottom: none;
    }

    .shg-label {
      color: var(--muted);
    }

    .shg-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--emerald);
    }
  </style>
</head>
<body>
  <div class="bg">
    <div class="grid"></div>
    <canvas id="particles"></canvas>
  </div>

  <header class="topbar">
    <div class="brand">
      <div style="cursor: pointer;" onclick="window.location.href='intelligence-dashboard.html'">
        <div class="logo">MS</div>
      </div>
      <div>
        <div class="brand-title">CIRCULAR INTELLIGENCE</div>
        <div class="brand-sub">Waste-to-Value Economics Engine</div>
      </div>
    </div>
    <div class="actions">
      <button class="ghost" onclick="window.location.href='intelligence-dashboard.html'">‚Üê Back to Dashboard</button>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-content">
        <div class="chip">Module 5 / 6</div>
        <h1>Circular Intelligence</h1>
        <p>Waste-to-value economic analysis connecting waste streams with processors, calculating net revenue, and measuring environmental impact while creating SHG employment.</p>
        <div class="hero-stats">
          <div class="stat glass">
            <div class="stat-value" id="totalValue">‚Çπ0</div>
            <div class="stat-label">Daily Value Generated</div>
          </div>
          <div class="stat glass">
            <div class="stat-value" id="jobsCount">0</div>
            <div class="stat-label">SHG Jobs Created</div>
          </div>
          <div class="stat glass">
            <div class="stat-value" id="wasteKgs">0</div>
            <div class="stat-label">Waste Processed</div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Waste Type Economics</h2>
        <p>Net revenue per waste type after collection and processing costs</p>
      </div>

      <div class="circular-grid" id="wasteTypes">
        <div class="circular-card">
          <div class="circular-title">Loading waste models...</div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Revenue Breakdown</h2>
      </div>

      <div class="card glass">
        <div class="revenue-breakdown" id="revenueBreakdown">
          <div style="grid-column: 1 / -1; color: var(--muted); text-align: center; padding: 40px;">
            Calculating revenue streams...
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Environmental Impact</h2>
      </div>

      <div class="card glass">
        <div class="environmental-impact" id="environmentalImpact">
          <div style="grid-column: 1 / -1; color: var(--muted); text-align: center; padding: 40px;">
            Calculating environmental metrics...
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Revenue Calculator</h2>
        <p>Enter waste amount (kg) to calculate economic potential</p>
      </div>

      <div class="card glass">
        <div class="calculator-section">
          <div style="margin-bottom: 15px;">
            <label style="color: var(--cyan); font-weight: 600; display: block; margin-bottom: 8px;">Waste Type</label>
            <select id="wasteTypeSelect" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(54, 240, 255, 0.2); color: var(--cyan); border-radius: 6px;">
              <option value="plastic">Plastic</option>
              <option value="organic">Organic</option>
              <option value="ewaste">E-Waste</option>
              <option value="construction">Construction</option>
              <option value="metal">Metal</option>
              <option value="mixed">Mixed</option>
            </select>
          </div>

          <div class="calc-input">
            <input type="number" id="wasteWeight" placeholder="Enter weight (kg)" />
            <button class="calc-button" onclick="calculateValue()">Calculate Value</button>
          </div>

          <div id="calcResult" style="display: none;" class="calc-result">
            <div class="result-title">üìä Value Analysis</div>
            <div id="resultContent"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>SHG Network & Employment</h2>
      </div>

      <div class="card glass">
        <div class="shg-network">
          <div class="shg-title">Self-Help Group (SHG) Employment</div>
          <div class="shg-stat">
            <div class="shg-label">Total SHG Jobs (Daily)</div>
            <div class="shg-value" id="shgJobsDaily">0</div>
          </div>
          <div class="shg-stat">
            <div class="shg-label">Active SHG Networks</div>
            <div class="shg-value">12</div>
          </div>
          <div class="shg-stat">
            <div class="shg-label">Average Wage per Job</div>
            <div class="shg-value">‚Çπ500</div>
          </div>
          <div class="shg-stat">
            <div class="shg-label">Monthly SHG Income</div>
            <div class="shg-value" id="shgMonthlyIncome">‚Çπ0</div>
          </div>
        </div>

        <div style="margin-top: 20px;">
          <div style="color: var(--cyan); font-weight: 600; margin-bottom: 10px;">SHG Distribution Network</div>
          <div style="background: rgba(255, 255, 255, 0.03); padding: 15px; border-radius: 8px;">
            <div style="color: var(--muted); font-size: 0.9rem;">
              SHGs are organized into 3 zones covering Madurai corporation:
            </div>
            <ul style="list-style: none; padding: 10px 0 0 0; margin: 0;">
              <li style="padding: 8px 0; color: var(--muted); font-size: 0.85rem;">
                üåç <strong>North Zone</strong> - 4 groups, 45 members
              </li>
              <li style="padding: 8px 0; color: var(--muted); font-size: 0.85rem;">
                üåç <strong>Central Zone</strong> - 5 groups, 62 members
              </li>
              <li style="padding: 8px 0; color: var(--muted); font-size: 0.85rem;">
                üåç <strong>South Zone</strong> - 3 groups, 38 members
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2>Algorithm Details</h2>
      </div>
      <div class="card glass">
        <div style="padding: 20px 0;">
          <div style="margin-bottom: 20px;">
            <div style="color: var(--cyan); font-weight: 600; margin-bottom: 8px;">Net Revenue Calculation</div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9rem;">
              netRevenue = (salePrice √ó weight) - collectionCost - processingCost<br/>
              Example (Plastic 1kg):<br/>
              &nbsp;&nbsp;= (‚Çπ25 √ó 1) - ‚Çπ0.5 - ‚Çπ0.7<br/>
              &nbsp;&nbsp;= ‚Çπ23.8
            </div>
          </div>

          <div style="margin-bottom: 20px;">
            <div style="color: var(--cyan); font-weight: 600; margin-bottom: 8px;">Environmental Metrics per Kg</div>
            <ul style="list-style: none; padding: 0;">
              <li style="padding: 8px 0; color: var(--muted);"><strong style="color: var(--emerald);">CO‚ÇÇ Saved:</strong> Avoided landfill decomposition</li>
              <li style="padding: 8px 0; color: var(--muted);"><strong style="color: var(--emerald);">Water Saved:</strong> Reduced manufacturing water usage</li>
              <li style="padding: 8px 0; color: var(--muted);"><strong style="color: var(--emerald);">Energy Saved:</strong> Recycling requires less energy than new production</li>
            </ul>
          </div>

          <div>
            <div style="color: var(--cyan); font-weight: 600; margin-bottom: 8px;">SHG Employment Calculation</div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9rem;">
              shgJobs = weight / 50<br/>
              (1 SHG job per 50kg processed)
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="intelligence.js"></script>
  <script>
    // Fetch circular economy data from API
    async function fetchCircularData() {
      try {
        const response = await fetch('http://localhost:3000/api/intelligence/circular');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const result = await response.json();
        return result.data;
      } catch (error) {
        console.warn('API error, using fallback:', error);
        return initializeMockCircularData();
      }
    }

    function initializeMockCircularData() {
      const wasteModels = {
        plastic: { name: 'üî§ Plastic', salePrice: 25, processingCost: 0.7, collectionCost: 0.5 },
        organic: { name: 'üçÉ Organic', salePrice: 22, processingCost: 0.4, collectionCost: 0.3 },
        ewaste: { name: 'üíª E-Waste', salePrice: 45, processingCost: 2.0, collectionCost: 1.5 },
        construction: { name: 'üèóÔ∏è Construction', salePrice: 12, processingCost: 0.5, collectionCost: 0.8 },
        metal: { name: '‚öôÔ∏è Metal', salePrice: 35, processingCost: 1.2, collectionCost: 0.6 }
      };

      let totalDailyValue = 0;
      let totalJobs = 0;
      let totalWeight = 0;
      const wasteData = [];

      Object.entries(wasteModels).map(([key, model]) => {
        const weight = Math.random() * 50 + 20;
        const netValue = (model.salePrice * weight) - (model.processingCost * weight) - (model.collectionCost * weight);
        const jobs = Math.floor(weight / 50);
        totalDailyValue += netValue;
        totalJobs += jobs;
        totalWeight += weight;

        return wasteData.push({
          wasteType: key,
          weight: weight,
          salePrice: model.salePrice,
          collectionCost: model.collectionCost,
          processingCost: model.processingCost,
          netValue: netValue,
          jobs: jobs
        });
      });

      return {
        totalDailyValue: totalDailyValue,
        totalJobs: totalJobs,
        totalWeight: totalWeight,
        wasteByType: wasteData,
        environmental: {
          co2Saved: totalWeight * 2.4,
          waterSaved: totalWeight * 14,
          energySaved: totalWeight * 7
        },
        shg: {
          jobsDaily: totalJobs,
          monthlyIncomePerJob: 500,
          monthlyTotalIncome: totalJobs * 30 * 500
        }
      };
    }

    async function updateModule() {
      const circularData = await fetchCircularData();

      // Waste type cards
      const wasteTypesContainer = document.getElementById('wasteTypes');
      const wasteTypeIcons = { plastic: 'üî§', organic: 'üçÉ', metal: '‚öôÔ∏è', glass: 'üì¶', ewaste: 'üíª', construction: 'üèóÔ∏è', hazardous: '‚ö†Ô∏è' };

      wasteTypesContainer.innerHTML = circularData.wasteByType.map(waste => {
        return `
          <div class="circular-card">
            <div class="circular-title">${wasteTypeIcons[waste.wasteType] || 'üóëÔ∏è'} ${waste.wasteType.charAt(0).toUpperCase() + waste.wasteType.slice(1)}</div>
            <div class="waste-type-value">‚Çπ${waste.netValue.toFixed(0)}</div>
            <div class="metric-label">Net Revenue (${waste.weight.toFixed(0)}kg)</div>
            <div class="value-breakdown">
              <div class="value-item">
                <span class="value-label">Sale Price</span>
                <span class="value-amount">‚Çπ${(waste.salePrice * waste.weight).toFixed(0)}</span>
              </div>
              <div class="value-item">
                <span class="value-label">Collection Cost</span>
                <span class="value-amount">-‚Çπ${(waste.collectionCost * waste.weight).toFixed(1)}</span>
              </div>
              <div class="value-item">
                <span class="value-label">Processing Cost</span>
                <span class="value-amount">-‚Çπ${(waste.processingCost * waste.weight).toFixed(1)}</span>
              </div>
            </div>
          </div>
        `;
      }).join('');

      // Revenue breakdown
      const revenueBreakdown = document.getElementById('revenueBreakdown');
      const collectionRevenue = circularData.totalDailyValue * 0.1;
      const processingRevenue = circularData.totalDailyValue * 0.45;
      const saleRevenue = circularData.totalDailyValue * 0.45;

      revenueBreakdown.innerHTML = `
        <div class="revenue-item">
          <div class="revenue-icon">üí∞</div>
          <div class="revenue-value">‚Çπ${circularData.totalDailyValue.toFixed(0)}</div>
          <div class="revenue-label">Total Daily Revenue</div>
        </div>
        <div class="revenue-item">
          <div class="revenue-icon">üöõ</div>
          <div class="revenue-value">‚Çπ${collectionRevenue.toFixed(0)}</div>
          <div class="revenue-label">Collection Service</div>
        </div>
        <div class="revenue-item">
          <div class="revenue-icon">üè≠</div>
          <div class="revenue-value">‚Çπ${processingRevenue.toFixed(0)}</div>
          <div class="revenue-label">Processing Revenue</div>
        </div>
        <div class="revenue-item">
          <div class="revenue-icon">üì¶</div>
          <div class="revenue-value">‚Çπ${saleRevenue.toFixed(0)}</div>
          <div class="revenue-label">Sale of Processed</div>
        </div>
      `;

      // Environmental impact
      const environmentalImpact = document.getElementById('environmentalImpact');
      environmentalImpact.innerHTML = `
        <div class="impact-card">
          <div class="impact-value">${circularData.environmental.co2Saved.toFixed(0)} kg</div>
          <div class="impact-label">CO‚ÇÇ Emissions Avoided</div>
          <div style="color: var(--muted); font-size: 0.75rem; margin-top: 8px;">
            = ${(circularData.environmental.co2Saved / 2.5).toFixed(0)} km of car travel
          </div>
        </div>
        <div class="impact-card">
          <div class="impact-value">${circularData.environmental.waterSaved.toFixed(0)} L</div>
          <div class="impact-label">Water Consumption Reduced</div>
          <div style="color: var(--muted); font-size: 0.75rem; margin-top: 8px;">
            = ${(circularData.environmental.waterSaved / 1000).toFixed(1)} tons
          </div>
        </div>
        <div class="impact-card">
          <div class="impact-value">${circularData.environmental.energySaved.toFixed(0)} kWh</div>
          <div class="impact-label">Energy Saved via Recycling</div>
          <div style="color: var(--muted); font-size: 0.75rem; margin-top: 8px;">
            = ${(circularData.environmental.energySaved / 1000).toFixed(1)} MWh
          </div>
        </div>
      `;

      // Update hero stats
      document.getElementById('totalValue').textContent = '‚Çπ' + Math.round(circularData.totalDailyValue).toLocaleString();
      document.getElementById('jobsCount').textContent = circularData.totalJobs;
      document.getElementById('wasteKgs').textContent = circularData.totalWeight.toFixed(0) + ' kg';

      // SHG stats
      document.getElementById('shgJobsDaily').textContent = circularData.shg.jobsDaily;
      document.getElementById('shgMonthlyIncome').textContent = '‚Çπ' + circularData.shg.monthlyTotalIncome.toLocaleString();
    }

    function calculateValue() {
      const wasteType = document.getElementById('wasteTypeSelect').value;
      const weight = parseFloat(document.getElementById('wasteWeight').value);

      if (!weight || weight <= 0) {
        alert('Please enter a valid weight');
        return;
      }

      const models = {
        plastic: { name: 'Plastic', salePrice: 25, processingCost: 0.7, collectionCost: 0.5, co2: 2.5, water: 15, energy: 8 },
        organic: { name: 'Organic', salePrice: 22, processingCost: 0.4, collectionCost: 0.3, co2: 1.8, water: 8, energy: 3 },
        ewaste: { name: 'E-Waste', salePrice: 45, processingCost: 2.0, collectionCost: 1.5, co2: 5.2, water: 28, energy: 15 },
        construction: { name: 'Construction', salePrice: 12, processingCost: 0.5, collectionCost: 0.8, co2: 0.8, water: 4, energy: 2 },
        metal: { name: 'Metal', salePrice: 35, processingCost: 1.2, collectionCost: 0.6, co2: 3.8, water: 22, energy: 12 },
        mixed: { name: 'Mixed', salePrice: 18, processingCost: 0.6, collectionCost: 0.4, co2: 1.5, water: 9, energy: 5 }
      };

      const model = models[wasteType];
      const netRevenue = (model.salePrice * weight) - (model.processingCost * weight) - (model.collectionCost * weight);
      const jobs = Math.floor(weight / 50);
      const co2 = weight * model.co2;
      const water = weight * model.water;
      const energy = weight * model.energy;

      const resultContent = document.getElementById('resultContent');
      resultContent.innerHTML = `
        <div style="margin-bottom: 15px;">
          <div style="color: var(--muted); font-size: 0.85rem;">Waste Type: <strong style="color: var(--cyan);">${model.name}</strong></div>
          <div style="color: var(--muted); font-size: 0.85rem;">Weight: <strong style="color: var(--cyan);">${weight} kg</strong></div>
        </div>
        <div style="background: rgba(54, 240, 255, 0.1); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
          <div style="color: var(--muted); font-size: 0.8rem;">NET REVENUE</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: var(--emerald);">‚Çπ${netRevenue.toFixed(2)}</div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem;">
          <div><span style="color: var(--muted);">Sale:</span> <strong style="color: var(--emerald);">‚Çπ${(model.salePrice * weight).toFixed(2)}</strong></div>
          <div><span style="color: var(--muted);">Jobs:</span> <strong style="color: var(--emerald);">${jobs}</strong></div>
          <div><span style="color: var(--muted);">Collection:</span> <strong>-‚Çπ${(model.collectionCost * weight).toFixed(2)}</strong></div>
          <div><span style="color: var(--muted);">CO‚ÇÇ Saved:</span> <strong style="color: var(--emerald);">${co2.toFixed(1)} kg</strong></div>
          <div><span style="color: var(--muted);">Processing:</span> <strong>-‚Çπ${(model.processingCost * weight).toFixed(2)}</strong></div>
          <div><span style="color: var(--muted);">Water Saved:</span> <strong style="color: var(--emerald);">${water.toFixed(0)} L</strong></div>
        </div>
      `;

      document.getElementById('calcResult').style.display = 'block';
    }

    document.addEventListener('DOMContentLoaded', updateModule);
  </script>
  <script src="enhanced-app.js"></script>
</body>
</html>